C51 COMPILER V9.00   4ZY08_Cң_С                                           01/16/2015 16:47:04 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE 4ZY08_Cң_С
OBJECT MODULE PLACED IN 4ZY08-CңС.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 4ZY08-CңС.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*****************ZY08-CѭңءϡѰ*****************
   2          //=====================================================================//
   3                              ңʾ                         //
   4          //  ҪڱȽϳTX1300ңн,ͨP2//
   5          //ڵʾ,Ϊ˸õĿй,ؼָʾָʾ //
   6          //ǰ״̬.P10Ҫ,ʾ,P11ʾյ, //
   7          //P12ʾڲĶʱ.P13ʾȷһ.         //
   8          //  Ч: 򿪱Դ,ԿP10ͣ,ң//
   9          //ּ,ʾӦּ(1-9).ԿP11,P12ʾ״̬.//
  10          //Խһ,пԿP13һ.ϴȷ//
  11          //. 
  12          //---------------------------------------------------------------------//
  13          
  14          *  ƽ̨ZY08-CѭңءϡѰ + Keil U4 + STC89C52
  15          *  ƣ4ZY08-CңС
  16          *  ˾ƽ豸޹˾
  17          *  Աhttp://tmmcu1688.taobao.com       
  18          *  վwww.china-zhiyu.com    
  19          *  д˾зһ
  20          *  ڣ2015-1-15
  21          *  :ܳQQ:1018973181 
  22          *  :11.0592MHZ
  23          *  ۺ˵ѿԴֿ֧ͻԼ޸ĳṩҹ˾˵
  24          *  Ƶ̳̣СѧϰCϸƵ̳̣ͳһ
  25          ******************************************************************/   
  26          
  27          #include <reg52.h>                                  //51Ƭصͷļ
  28          #include <intrins.h>
  29          #define uint    unsigned int                          //ض޷
  30          #define uchar   unsigned char                         //ض޷ַ
  31          
  32          uchar code  LedShowData[]={0x03,0x9F,0x25,0x0D,0x99,  //ʾ
  33                                      0x49,0x41,0x1F,0x01,0x19};//0,1,2,3,4,5,6,7,8,9
  34          
  35          uchar code  RecvData[]={0x19,0x46,0x15,0x44,0x43,0x40,0x0D,0x0E,0x00,0x0F};
  36          
  37          uchar IRCOM[7];
  38          
  39          static unsigned int LedFlash;                         //Ƶʼ
  40          
  41          unsigned char RunFlag=0;                              //б־λ
  42          bit EnableLight=0;                                    //ָʾʹλ
  43          /***********ɻݱ**************/
  44          sbit S1State=P1^0;                                    //S1״̬־λ
  45          sbit S2State=P1^1;                                    //S2״̬־λ
  46          sbit B1State=P1^2;                                    //B1״̬־λ
  47          sbit IRState=P1^3;                                    //IR״̬־λ
  48          sbit RunStopState=P1^4;                               //ֹͣ־λ
  49          sbit FontIRState=P1^5;                                //FontIR״̬־λ
  50          sbit LeftIRState=P1^6;                                //LeftIR״̬־λ
  51          sbit RightIRState=P1^7;                               //RightIRState״̬־λ
  52          /*************״ָ̬ʾƶ*************/
  53          sbit S1=P3^2;                                         //S1˿
  54          sbit S2=P3^4;                                         //S2˿
  55          /*************ɰ˿ڵĶ*************/       
C51 COMPILER V9.00   4ZY08_Cң_С                                           01/16/2015 16:47:04 PAGE 2   

  56          sbit LeftLed=P2^0;                                    //ǰָʾƶ˿
  57          sbit RightLed=P0^7;                                   //ǰҲָʾƶ˿
  58          /*************ǰָʾƶ˿ڶ*********/
  59          sbit LeftIR=P3^5;                                     //ǰ̽ͷ
  60          sbit RightIR=P3^6;                                    //ǰҲ̽ͷ
  61          sbit FontIR=P3^7;                                     //ǰ̽ͷ
  62          /*************ɺ̽ͷ˿ڶ***********/
  63          sbit M1A=P0^0;                                        //1˿
  64          sbit M1B=P0^1;                                        //1˿
  65          sbit M2A=P0^2;                                        //2˿
  66          sbit M2B=P0^3;                                        //2˿
  67          /*************ɵ˿ڶ***************/
  68          sbit B1=P0^4;                                         //廰Ͳ˿
  69          sbit RL1=P0^5;                                        //˿
  70          sbit SB1=P0^6;                                        //˿
  71          /*********ɻͲ,,.˿ڶ**/
  72          sbit IRIN=P3^3;                                       //ն˿
  73          /*********ɺն˿ڵĶ*************/
  74          #define ShowPort P2                                   //ʾ˿
  75          
  76          extern void ControlCar(uchar CarType);                //Сӳ
  77          
  78          void delayms(unsigned char x)                         //0.14mSʱ
  79          {
  80   1        unsigned char i;                                    //ʱ
  81   1        while(x--)                                          //ʱʱѭ
  82   1        {
  83   2          for (i = 0; i<13; i++) {}                         //14mSʱ
  84   2        }
  85   1      }
  86          
  87          void Delay1ms(unsigned int i) 
  88          { 
  89   1      unsigned char j,k; 
  90   1      do{ 
  91   2        j = 10; 
  92   2        do{ 
  93   3         k = 50; 
  94   3         do{ 
  95   4          _nop_(); 
  96   4         }while(--k);     
  97   3        }while(--j); 
  98   2      }while(--i); 
  99   1      
 100   1      } 
 101          void Delay()                                          //ʱӳ
 102          { uint DelayTime=30000;                               //ʱʱ
 103   1        while(DelayTime--);                                 //ʼʱѭ
 104   1        return;                                             //ӳ򷵻
 105   1      }
 106          
 107          void tingzhi()
 108          {
 109   1         M1A=0;                                   //M1A˳ʼΪ0
 110   1         M1B=0;                                   //M1B˳ʼΪ0
 111   1         M2A=0;                                   //M2A˳ʼΪ0
 112   1         M2B=0;
 113   1      
 114   1      }
 115          
 116          void qianjin()
 117          {
C51 COMPILER V9.00   4ZY08_Cң_С                                           01/16/2015 16:47:04 PAGE 3   

 118   1         M1A=1;                                   
 119   1         M1B=0;                                   
 120   1         M2A=1;                                   
 121   1         M2B=0;
 122   1      }
 123          
 124          void houtui()
 125          {
 126   1         M1A=0;                                   
 127   1         M1B=1;                                   
 128   1         M2A=0;                                   
 129   1         M2B=1;
 130   1      }
 131          
 132          void youzhuan()
 133          {
 134   1         M1A=0;                                   
 135   1         M1B=1;                                   
 136   1         M2A=1;                                   
 137   1         M2B=0;
 138   1      
 139   1      }
 140          
 141          void zuozhuan()
 142          {
 143   1         M1A=1;                                   
 144   1         M1B=0;                                   
 145   1         M2A=0;                                   
 146   1         M2B=1;
 147   1      
 148   1      }
 149          
 150          void ControlCar(unsigned char ConType)    //ӳ
 151          {
 152   1       
 153   1        tingzhi();
 154   1       switch(ConType)                          //жû趨ʽ
 155   1       {
 156   2        case 1:  //ǰ                         //жûǷѡʽ1
 157   2        { 
 158   3          
 159   3              tingzhi();                                                    //ǰ֮ǰ ֹͣһʱ  ֹѹ ϵͳλ
 160   3               Delay1ms(240);
 161   3              LeftLed = 0 ;
 162   3              qianjin();
 163   3          break;
 164   3        }
 165   2        case 2: //                          //жûǷѡʽ2
 166   2        { 
 167   3          tingzhi();                                                     //֮ǰ ֹͣһʱ  ֹѹ ϵͳλ
 168   3                Delay1ms(240);
 169   3              LeftLed = 1 ;    
 170   3              houtui();                                //M2ת
 171   3          break;
 172   3        }
 173   2        case 3: //ת                          //жûǷѡʽ3
 174   2        { 
 175   3          tingzhi();                                                            //ת֮ǰ ֹͣһʱ  ֹѹ ϵͳλ
 176   3               Delay1ms(240); 
 177   3              zuozhuan();                               //M2ת
 178   3              break;
 179   3        }
C51 COMPILER V9.00   4ZY08_Cң_С                                           01/16/2015 16:47:04 PAGE 4   

 180   2        case 4: //ת                          //жûǷѡʽ4
 181   2        { 
 182   3          tingzhi();                                                            //ת֮ǰ ֹͣһʱ  ֹѹ ϵͳλ
 183   3                Delay1ms(240);
 184   3              youzhuan();                                //M1ת
 185   3                                                //M2ת
 186   3              break;
 187   3        }
 188   2        case 5: //ֹͣ                          //жûǷѡʽ8
 189   2        {
 190   3          tingzhi();
 191   3              break;                                //˳ǰѡ
 192   3        }
 193   2       }
 194   1      }
 195          
 196          void IR_IN() interrupt 2 using 0                      //INT2ⲿжϺ
 197          {
 198   1        unsigned char j,k,N=0;                              //ʱձ
 199   1         
 200   1        EX1 = 0;                                            //رⲿж,ֹźŵ   
 201   1        delayms(15);                                        //ʱʱ䣬к
 202   1        if (IRIN==1)                                        //жϺźǷʧ
 203   1        {  
 204   2           EX1 =1;                                          //ⲿжϿ
 205   2               return;                                          //
 206   2        } 
 207   1                                 
 208   1        while (!IRIN)                                       //IRΪߵƽ9msǰ͵ƽźš
 209   1        {
 210   2            delayms(1);                                     //ʱȴ
 211   2        }
 212   1      
 213   1        for (j=0;j<4;j++)                                   //ɼң
 214   1        { 
 215   2          for (k=0;k<8;k++)                                 //ִβɼ8λ
 216   2          {
 217   3             while (IRIN)                                   // IR Ϊ͵ƽ4.5msǰߵƽźš
 218   3             {
 219   4               delayms(1);                                  //ʱȴ
 220   4             }
 221   3             
 222   3             while (!IRIN)                                  // IR Ϊߵƽ
 223   3             {
 224   4               delayms(1);                                  //ʱȴ
 225   4             }
 226   3         
 227   3             while (IRIN)                                   //IRߵƽʱ
 228   3             {
 229   4               delayms(1);                                  //ʱȴ
 230   4               N++;                                         //Ӽ
 231   4               if (N>=30)                                   //жϼۼֵ
 232   4                   { 
 233   5                 EX1=1;                                     //ⲿжϹ
 234   5                     return;                                    //
 235   5               }                   
 236   4             }
 237   3                                             
 238   3            IRCOM[j]=IRCOM[j] >> 1;                         //λƲԶ
 239   3           
 240   3            if (N>=8)                                       //жݳ 
 241   3            {
C51 COMPILER V9.00   4ZY08_Cң_С                                           01/16/2015 16:47:04 PAGE 5   

 242   4               IRCOM[j] = IRCOM[j] | 0x80;                  //λ1
 243   4            } 
 244   3            N=0;                                            //λ¼
 245   3          }
 246   2        }
 247   1         
 248   1        if (IRCOM[2]!=~IRCOM[3])                            //жϵַǷͬ
 249   1        { 
 250   2           EX1=1;                                           //ⲿж
 251   2           return;                                          //
 252   2        }
 253   1      
 254   1        for(j=0;j<10;j++)                                   //ѭм
 255   1         {
 256   2            if(IRCOM[2]==RecvData[j])                       //мλӦ
 257   2            {
 258   3              ControlCar(j);                                          //ʾӦ
 259   3            }
 260   2         }
 261   1         
 262   1         
 263   1         EX1 = 1;                                           //ⲿжϿ 
 264   1      } 
 265          
 266          
 267          
 268          void main(void)                                       //
 269          {
 270   1       bit ExeFlag=0;                                       //ִλ
 271   1       
 272   1       LedFlash=3000;                                       //ݽгʼ
 273   1       EX1=1;                                               //ͬ⿪ⲿж1
 274   1       IT1=1;                                               //趨ⲿж1ΪͱԵ
 275   1       EA=1;                                                //жϿ
 276   1       ShowPort=LedShowData[0];                             //ʾ0
 277   1      while(1)                                              //ѭ
 278   1       {
 279   2         
 280   2         Delay();                                           //ʱ
 281   2         RunStopState=~RunStopState;                        //ָʾ״̬ת
 282   2        
 283   2       }
 284   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    365    ----
   CONSTANT SIZE    =     20    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
